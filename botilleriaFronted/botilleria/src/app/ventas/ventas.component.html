<div class="header">
  <h2>Historial de Ventas</h2>
  <mat-card class="total-card">
    <mat-card-content>
      <span class="total-label">Total Ventas:</span>
      <span class="total-value">${{ totalVentas | number:'1.0-0' }}</span>
    </mat-card-content>
  </mat-card>
</div>

<mat-tab-group>
  <!-- Tab: Historial de Ventas -->
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="tab-icon">receipt_long</mat-icon>
      Historial de Ventas
    </ng-template>

    <div class="tab-content">
      <table mat-table [dataSource]="ventas" class="mat-elevation-z8" *ngIf="ventas.length > 0">
        <ng-container matColumnDef="idVenta">
          <th mat-header-cell *matHeaderCellDef># Venta</th>
          <td mat-cell *matCellDef="let v">{{ v.idVenta }}</td>
        </ng-container>

        <ng-container matColumnDef="fecha">
          <th mat-header-cell *matHeaderCellDef>Fecha</th>
          <td mat-cell *matCellDef="let v">{{ v.fecha | date:'dd/MM/yyyy HH:mm' }}</td>
        </ng-container>

        <ng-container matColumnDef="total">
          <th mat-header-cell *matHeaderCellDef>Total</th>
          <td mat-cell *matCellDef="let v">${{ v.total | number:'1.0-0' }}</td>
        </ng-container>

        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let v">
            <button mat-icon-button color="primary" (click)="verDetalle(v)" matTooltip="Ver detalle">
              <mat-icon>visibility</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <div class="sin-ventas" *ngIf="ventas.length === 0">
        <mat-icon>point_of_sale</mat-icon>
        <p>No hay ventas registradas</p>
        <p class="hint">Las ventas realizadas en el POS apareceran aqui</p>
      </div>
    </div>
  </mat-tab>

  <!-- Tab: Productos Mas Vendidos -->
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="tab-icon">trending_up</mat-icon>
      Mas Vendidos
    </ng-template>

    <div class="tab-content">
      <div class="estadisticas-header">
        <h3>Top 10 Productos Mas Vendidos</h3>
        <mat-chip-set>
          <mat-chip color="primary" highlighted>
            <mat-icon>star</mat-icon>
            Mejores Ventas
          </mat-chip>
        </mat-chip-set>
      </div>

      <table mat-table [dataSource]="productosMasVendidos" class="mat-elevation-z8 tabla-estadisticas" *ngIf="productosMasVendidos.length > 0">
        <ng-container matColumnDef="posicion">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let p; let i = index">
            <span class="posicion" [class.top-3]="i < 3">{{ i + 1 }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>Producto</th>
          <td mat-cell *matCellDef="let p">
            <span class="producto-nombre">{{ p.nombre }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="categoria">
          <th mat-header-cell *matHeaderCellDef>Categoria</th>
          <td mat-cell *matCellDef="let p">
            <span class="categoria-chip">{{ p.categoria }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="cantidadVendida">
          <th mat-header-cell *matHeaderCellDef>Unidades Vendidas</th>
          <td mat-cell *matCellDef="let p">
            <span class="cantidad-vendida">{{ p.cantidadVendida }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="totalVendido">
          <th mat-header-cell *matHeaderCellDef>Total Vendido</th>
          <td mat-cell *matCellDef="let p">
            <span class="total-vendido">${{ p.totalVendido | number:'1.0-0' }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="numeroVentas">
          <th mat-header-cell *matHeaderCellDef>N. Ventas</th>
          <td mat-cell *matCellDef="let p">{{ p.numeroVentas }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="estadisticasColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: estadisticasColumns;"></tr>
      </table>

      <div class="sin-datos" *ngIf="productosMasVendidos.length === 0">
        <mat-icon>trending_up</mat-icon>
        <p>No hay datos de ventas</p>
        <p class="hint">Realiza ventas para ver las estadisticas</p>
      </div>
    </div>
  </mat-tab>

  <!-- Tab: Productos Menos Vendidos -->
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="tab-icon">trending_down</mat-icon>
      Menos Vendidos
    </ng-template>

    <div class="tab-content">
      <div class="estadisticas-header">
        <h3>Top 10 Productos Menos Vendidos</h3>
        <mat-chip-set>
          <mat-chip color="warn" highlighted>
            <mat-icon>warning</mat-icon>
            Requieren Atencion
          </mat-chip>
        </mat-chip-set>
      </div>

      <table mat-table [dataSource]="productosMenosVendidos" class="mat-elevation-z8 tabla-estadisticas" *ngIf="productosMenosVendidos.length > 0">
        <ng-container matColumnDef="posicion">
          <th mat-header-cell *matHeaderCellDef>#</th>
          <td mat-cell *matCellDef="let p; let i = index">
            <span class="posicion warning">{{ i + 1 }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef>Producto</th>
          <td mat-cell *matCellDef="let p">
            <span class="producto-nombre">{{ p.nombre }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="categoria">
          <th mat-header-cell *matHeaderCellDef>Categoria</th>
          <td mat-cell *matCellDef="let p">
            <span class="categoria-chip">{{ p.categoria }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="cantidadVendida">
          <th mat-header-cell *matHeaderCellDef>Unidades Vendidas</th>
          <td mat-cell *matCellDef="let p">
            <span class="cantidad-vendida" [class.zero]="p.cantidadVendida === 0">{{ p.cantidadVendida }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="totalVendido">
          <th mat-header-cell *matHeaderCellDef>Total Vendido</th>
          <td mat-cell *matCellDef="let p">
            <span class="total-vendido">${{ p.totalVendido | number:'1.0-0' }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="numeroVentas">
          <th mat-header-cell *matHeaderCellDef>N. Ventas</th>
          <td mat-cell *matCellDef="let p">{{ p.numeroVentas }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="estadisticasColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: estadisticasColumns;"></tr>
      </table>

      <div class="sin-datos" *ngIf="productosMenosVendidos.length === 0">
        <mat-icon>trending_down</mat-icon>
        <p>No hay datos de productos</p>
        <p class="hint">Agrega productos para ver las estadisticas</p>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
